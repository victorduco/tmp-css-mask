<template>
  <div id="app">
    <div class="background-block"></div>

    <!-- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ mask —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <MaskElement
      v-for="maskObj in maskObjects"
      :key="maskObj.id"
      :config="maskObj"
    />

    <!-- Perspective –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å) -->
    <div
      class="perspective-container"
      :style="{ perspective: '1000px' }"
    >
    </div>

    <div class="transform-info">
      <h3>Multiple Mask Elements Demo:</h3>
      <div class="control-group">
        <label>Objects Count: {{ maskObjects.length }}</label>
      </div>
      <div class="control-group">
        <button
          @click="startChaos"
          style="
            padding: 10px 20px;
            background: #ff6b6b;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
          "
        >
          üé≠ START CHAOS ANIMATION
        </button>
      </div>
      <div class="info">
        <p>‚ú® Each element automatically syncs its background</p>
        <p>üéØ Try dragging the elements around</p>
        <p>üåÄ Watch how backgrounds stay in sync during animation</p>
      </div>
    </div>

    <div class="scroll-content">
      <p>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞</p>
      <p>–ï—â–µ –æ–¥–∏–Ω –±–ª–æ–∫ —Ç–µ–∫—Å—Ç–∞</p>
      <p>–ò –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
      <p>–ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
      <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import MaskElement from './components/MaskElement.vue';

// –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ mask –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
const maskObjects = ref([
  {
    id: 1,
    element: {
      top: 150,
      left: 200,
      width: 200,
      height: 200,
    },
    transforms: {
      perspective: 1000,
      translateX: 0,
      translateY: 0,
      translateZ: 0,
      rotateX: 0,
      rotateY: 0,
      rotateZ: 0,
      scale: 1.5,
      skewX: 0,
      skewY: 0,
    },
    background: {
      positionX: -100,
      positionY: -100,
      size: "100vw auto",
      sizeX: "100vw",
      sizeY: "100vh",
    },
    ui: {
      opacity50: false,
    },
    rotateMode: "2d"
  },
  {
    id: 2,
    element: {
      top: 300,
      left: 400,
      width: 250,
      height: 250,
    },
    transforms: {
      perspective: 1000,
      translateX: 0,
      translateY: 0,
      translateZ: 0,
      rotateX: 0,
      rotateY: 0,
      rotateZ: 0,
      scale: 2,
      skewX: 0,
      skewY: 0,
    },
    background: {
      positionX: -100,
      positionY: -100,
      size: "100vw auto",
      sizeX: "100vw",
      sizeY: "100vh",
    },
    ui: {
      opacity50: false,
    },
    rotateMode: "3d"
  },
  {
    id: 3,
    element: {
      top: 100,
      left: 600,
      width: 180,
      height: 180,
    },
    transforms: {
      perspective: 1000,
      translateX: 0,
      translateY: 0,
      translateZ: 0,
      rotateX: 0,
      rotateY: 0,
      rotateZ: 0,
      scale: 1.2,
      skewX: 0,
      skewY: 0,
    },
    background: {
      positionX: -100,
      positionY: -100,
      size: "100vw auto",
      sizeX: "100vw",
      sizeY: "100vh",
    },
    ui: {
      opacity50: false,
    },
    rotateMode: "2d"
  }
]);

// –ó–∞–ø—É—Å–∫ —Ö–∞–æ—Ç–∏—á–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
const startChaos = () => {
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
  maskObjects.value.forEach((obj, index) => {
    setTimeout(() => {
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
      const animate = () => {
        const time = Date.now() * 0.001;
        const id = obj.id;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Ö–∞–æ—Ç–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
        obj.transforms.translateX = Math.sin(time * 0.5 + id) * 100;
        obj.transforms.translateY = Math.cos(time * 0.3 + id) * 80;
        obj.transforms.rotateZ = Math.sin(time * 0.2 + id) * 45;
        obj.transforms.scale = 1.5 + Math.sin(time * 0.4 + id) * 0.5;
        obj.element.left = 400 + Math.sin(time * 0.1 + id) * 200;
        obj.element.top = 300 + Math.cos(time * 0.15 + id) * 150;

        requestAnimationFrame(animate);
      };

      animate();
    }, index * 500);
  });
};

onMounted(() => {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ö–∞–æ—Ç–∏—á–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    startChaos();
  }, 2000);
});
</script>

<style>
/* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ style.css */
</style>